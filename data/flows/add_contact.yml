flows:
  add_contact:
    description: add a contact to your contact list
    name: add a contact
    steps:
      - id: "add_contact_handle"
        collect: "add_contact_handle"
        description: "a user handle starting with @"
        rejections:
          - if: "not slots.add_contact_handle matches '@.+?'"
            utter: utter_add_contact_handle_start_at_symbol
      - action: check_handle_existence
        next:
          - if: "slots.return_value"
            then: add_contact_name
          - else:
              - action: utter_add_contact_handle_does_not_exist
              - set_slots:
                  - add_contact_handle: null
                next: add_contact_handle
      - id: "add_contact_name"
        collect: "add_contact_name"
        description: "a name of a person"
      - collect: "add_contact_confirmation"
        ask_before_filling: true
        next:
          - if: not slots.add_contact_confirmation
            then:
              - action: utter_add_contact_cancelled
                next: END
          - else: add_contact
      - id: add_contact
        action: add_contact
        next:
          - if: "slots.return_value = 'success'"
            then:
              - action: utter_contact_added
                next: END
          - if: "slots.return_value = 'already_exists'"
            then:
              - action: utter_contact_already_exists
                next: END
          - else:
              - action: utter_add_contact_error
                next: END
